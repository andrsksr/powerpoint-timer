<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PowerPoint Timer</title>
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #001B2E;
            color: white;
        }

        .container {
            background: white;
            color: #333;
            border-radius: 16px;
            padding: 24px;
            max-width: 400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 24px;
        }

        .header h1 {
            margin: 0;
            color: #001B2E;
        }

        .time-inputs {
            display: flex;
            gap: 20px;
            margin-bottom: 24px;
        }

        .time-input {
            flex: 1;
            text-align: center;
        }

        .time-input label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }

        .time-input input {
            width: 100%;
            padding: 12px 8px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            box-sizing: border-box;
        }

        .time-input input:focus {
            outline: none;
            border-color: #001B2E;
        }

        .timer-preview {
            text-align: center;
            margin: 24px 0;
        }

        .timer-circle {
            position: relative;
            width: 150px;
            height: 150px;
            margin: 0 auto;
            border-radius: 50%;
            background: #001B2E;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid #333;
        }

        .timer-display {
            font-size: 28px;
            font-weight: bold;
            color: white;
        }

        .progress-ring {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 144px;
            height: 144px;
            transform: rotate(-90deg);
        }

        .progress-circle {
            fill: none;
            stroke: #DCF98F;
            stroke-width: 6;
            stroke-linecap: butt;
            transition: stroke-dashoffset 0.3s ease;
        }

        .size-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .size-btn {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #ddd;
            background: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            text-align: center;
        }

        .size-btn.active {
            background: #001B2E;
            color: white;
            border-color: #001B2E;
        }

        .color-section {
            margin: 20px 0;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .color-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .color-row label {
            font-weight: 600;
        }

        .color-row input[type="color"] {
            width: 50px;
            height: 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        button {
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #001B2E;
            color: white;
        }

        .btn-primary:hover {
            background: #003366;
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #495057;
            border: 2px solid #ddd;
        }

        .debug {
            margin-top: 20px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>⏱️ Timer</h1>
            <p>Professional countdown timer for PowerPoint</p>
        </div>

        <div class="time-inputs">
            <div class="time-input">
                <label>Minutes</label>
                <input type="number" id="minutes" min="0" max="60" value="5">
            </div>
            <div class="time-input">
                <label>Seconds</label>
                <input type="number" id="seconds" min="0" max="59" value="0">
            </div>
        </div>

        <div class="timer-preview">
            <div class="timer-circle" id="timerCircle">
                <div class="progress-ring">
                    <svg width="144" height="144">
                        <circle cx="72" cy="72" r="68" class="progress-circle" id="progressCircle"></circle>
                    </svg>
                </div>
                <div class="timer-display" id="timerDisplay">05:00</div>
            </div>
        </div>

        <div class="size-buttons">
            <div class="size-btn" onclick="changeSize('small')">Small</div>
            <div class="size-btn active" onclick="changeSize('medium')">Medium</div>
            <div class="size-btn" onclick="changeSize('large')">Large</div>
        </div>

        <div class="color-section">
            <h3>Warning Times</h3>
            <div class="color-row">
                <label>Warning at (minutes):</label>
                <input type="number" id="warningTime" min="0" max="10" value="1" style="width: 60px; padding: 4px; text-align: center;">
            </div>
            <div class="color-row">
                <label>Critical at (seconds):</label>
                <input type="number" id="criticalTime" min="1" max="60" value="10" style="width: 60px; padding: 4px; text-align: center;">
            </div>
        </div>

        <div class="color-section">
            <h3>Colors</h3>
            <div class="color-row">
                <label>Timer Background:</label>
                <input type="color" id="timerColor" value="#001B2E" onchange="updateColors()">
            </div>
            <div class="color-row">
                <label>Text Color:</label>
                <input type="color" id="textColor" value="#FFFFFF" onchange="updateColors()">
            </div>
            <div class="color-row">
                <label>Progress Ring:</label>
                <input type="color" id="ringColor" value="#DCF98F" onchange="updateColors()">
            </div>
        </div>

        <div class="controls">
            <button class="btn-primary" onclick="insertTimer()">Insert Timer</button>
            <button class="btn-secondary" onclick="testTimer()">Test Animation</button>
        </div>
    </div>

    <script>
        let currentSize = 'medium';
        let testInterval = null;

        // Simple debug function (removed for production)
        function debug(message) {
            // Debug messages removed for clean production version
        }

        // Update timer display when inputs change
        function updateTimerDisplay() {
            const minutes = parseInt(document.getElementById('minutes').value) || 0;
            const seconds = parseInt(document.getElementById('seconds').value) || 0;
            const totalSeconds = minutes * 60 + seconds;
            
            const display = document.getElementById('timerDisplay');
            const timeString = formatTime(totalSeconds);
            display.textContent = timeString;
            // Debug removed for production
        }

        // Format seconds to MM:SS
        function formatTime(totalSeconds) {
            const mins = Math.floor(totalSeconds / 60);
            const secs = totalSeconds % 60;
            return mins.toString().padStart(2, '0') + ':' + secs.toString().padStart(2, '0');
        }

        // Change timer size
        function changeSize(size) {
            currentSize = size;
            
            // Update active button
            document.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const circle = document.getElementById('timerCircle');
            const display = document.getElementById('timerDisplay');
            const progressRing = document.querySelector('.progress-ring');
            const svg = progressRing.querySelector('svg');
            const progressCircles = progressRing.querySelectorAll('circle');
            
            let circleSize, fontSize, ringSize, radius, strokeWidth;
            
            if (size === 'small') {
                circleSize = 100;
                fontSize = '18px';
                ringSize = 94;  // Closer to edge - was 92
                radius = 44;    // Adjusted for closer fit
                strokeWidth = 4;
            } else if (size === 'large') {
                circleSize = 200;
                fontSize = '36px';
                ringSize = 192;
                radius = 92;
                strokeWidth = 8;
            } else { // medium
                circleSize = 150;
                fontSize = '28px';
                ringSize = 142;
                radius = 67;
                strokeWidth = 6;
            }
            
            // Update timer circle
            circle.style.width = circleSize + 'px';
            circle.style.height = circleSize + 'px';
            display.style.fontSize = fontSize;
            
            // Update progress ring - position INSIDE the circle
            progressRing.style.width = ringSize + 'px';
            progressRing.style.height = ringSize + 'px';
            
            // Smaller margin for small size, 4px for others
            const margin = (size === 'small') ? '3px' : '4px';
            progressRing.style.top = margin;
            progressRing.style.left = margin;
            
            // Update SVG size
            svg.setAttribute('width', ringSize);
            svg.setAttribute('height', ringSize);
            
            // Update circles (now just one circle)
            const center = ringSize / 2;
            const progressCircle = progressRing.querySelector('circle');
            progressCircle.setAttribute('cx', center);
            progressCircle.setAttribute('cy', center);
            progressCircle.setAttribute('r', radius);
            progressCircle.style.strokeWidth = strokeWidth;
            
            // Debug removed for production
        }

        // Update colors
        function updateColors() {
            const timerColor = document.getElementById('timerColor').value;
            const textColor = document.getElementById('textColor').value;
            const ringColor = document.getElementById('ringColor').value;
            
            const circle = document.getElementById('timerCircle');
            const display = document.getElementById('timerDisplay');
            const ring = document.getElementById('progressCircle');
            
            circle.style.background = timerColor;
            circle.style.borderColor = timerColor; // Make border match background
            display.style.color = textColor;
            ring.style.stroke = ringColor;
        }

        // Test animation
        function testTimer() {
            if (testInterval) {
                clearInterval(testInterval);
                testInterval = null;
                updateTimerDisplay(); // Reset to original time
                const progressCircle = document.getElementById('progressCircle');
                progressCircle.style.strokeDashoffset = '0'; // Reset progress ring
                return;
            }

            const minutes = parseInt(document.getElementById('minutes').value) || 0;
            const seconds = parseInt(document.getElementById('seconds').value) || 0;
            let timeLeft = minutes * 60 + seconds;
            const totalTime = timeLeft;
            
            if (timeLeft <= 0) {
                // Production message instead of debug
                alert('Please set a time greater than 0');
                return;
            }

            const progressCircle = document.getElementById('progressCircle');
            const circumference = 2 * Math.PI * getCurrentRadius();
            progressCircle.style.strokeDasharray = circumference;
            progressCircle.style.strokeDashoffset = '0'; // Start with full ring
            progressCircle.style.opacity = '1'; // Make sure it's visible
            
            testInterval = setInterval(() => {
                if (timeLeft <= 0) {
                    clearInterval(testInterval);
                    testInterval = null;
                    progressCircle.style.strokeDashoffset = circumference; // Hide ring completely
                    progressCircle.style.opacity = '0'; // Also fade out for good measure
                    return;
                }
                
                timeLeft--;
                document.getElementById('timerDisplay').textContent = formatTime(timeLeft);
                
                // Update progress ring - show REMAINING time, not elapsed
                const remainingProgress = timeLeft / totalTime;
                const offset = circumference * (1 - remainingProgress);
                progressCircle.style.strokeDashoffset = offset;
                
                // Get warning times from UI
                const warningMinutes = parseInt(document.getElementById('warningTime').value) || 1;
                const criticalSeconds = parseInt(document.getElementById('criticalTime').value) || 10;
                const warningSeconds = warningMinutes * 60;
                
                // Change colors - INCLUDING BORDER with exact matching
                const circle = document.getElementById('timerCircle');
                if (timeLeft <= criticalSeconds) {
                    circle.style.background = '#FF4444';
                    circle.style.borderColor = '#FF4444'; // Exact same red
                } else if (timeLeft <= warningSeconds) {
                    circle.style.background = '#FFA500';
                    circle.style.borderColor = '#FFA500'; // Exact same orange
                } else {
                    circle.style.background = document.getElementById('timerColor').value;
                    circle.style.borderColor = '#333'; // Default grey border
                }
            }, 1000);
        }

        // Get current radius based on size
        function getCurrentRadius() {
            if (currentSize === 'small') return 44; // Updated for closer fit
            if (currentSize === 'large') return 92;
            return 67; // medium
        }

        // Insert timer (placeholder)
        function insertTimer() {
            alert('Timer ready to insert into PowerPoint!');
        }

        // Setup event listeners when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Add input listeners
            document.getElementById('minutes').addEventListener('input', updateTimerDisplay);
            document.getElementById('seconds').addEventListener('input', updateTimerDisplay);
            
            // Initialize
            updateTimerDisplay();
            updateColors();
        });

        // Office.js initialization (only if Office is available)
        if (typeof Office !== 'undefined') {
            Office.onReady((info) => {
                // Clean production version - no debug messages
            });
        }
    </script>
</body>
</html>
